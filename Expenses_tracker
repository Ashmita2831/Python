import tkinter as tk
from tkinter import messagebox, ttk
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

# File to store data
FILE = "expenses.csv"

# Create empty CSV if not present
try:
    pd.read_csv(FILE)
except FileNotFoundError:
    pd.DataFrame(columns=["Date", "Category", "Amount"]).to_csv(FILE, index=False)

# Save expense
def save_expense():
    date = date_entry.get()
    category = category_var.get()
    amount = amount_entry.get()

    if not date or category == "Select" or not amount:
        messagebox.showwarning("Warning", "Please fill all fields!")
        return

    try:
        amount = float(amount)
    except ValueError:
        messagebox.showerror("Error", "Amount must be a number!")
        return

    df = pd.read_csv(FILE)
    df.loc[len(df)] = [date, category, amount]
    df.to_csv(FILE, index=False)
    messagebox.showinfo("Saved", "Expense added successfully!")
    date_entry.delete(0, tk.END)
    amount_entry.delete(0, tk.END)
    category_var.set("Select")

# Summary
def show_summary():
    df = pd.read_csv(FILE)
    if df.empty:
        messagebox.showinfo("No Data", "No expenses yet.")
        return
    total = df["Amount"].sum()
    avg = df["Amount"].mean()
    messagebox.showinfo("Summary", f"Total Expenses: ‚Çπ{total:.2f}\nAverage Expense: ‚Çπ{avg:.2f}")

# Show all expenses in a new window
def show_expenses():
    df = pd.read_csv(FILE)
    if df.empty:
        messagebox.showinfo("No Data", "No expenses recorded yet.")
        return

    # Create new window
    win = tk.Toplevel(root)
    win.title("All Expenses")
    win.geometry("400x300")
    win.config(bg="#EAF6F6")

    cols = ("Date", "Category", "Amount")
    tree = ttk.Treeview(win, columns=cols, show="headings")
    for col in cols:
        tree.heading(col, text=col)
        tree.column(col, width=120)
    for _, row in df.iterrows():
        tree.insert("", "end", values=list(row))
    tree.pack(expand=True, fill="both", padx=10, pady=10)

# Charts
def show_chart():
    df = pd.read_csv(FILE)
    if df.empty:
        messagebox.showinfo("No Data", "No data to visualize.")
        return

    df["Date"] = pd.to_datetime(df["Date"], errors="coerce")
    df = df.dropna(subset=["Date"])
    df = df.sort_values(by="Date")

    plt.figure(figsize=(10, 8))

    # 1Ô∏èBar Chart ‚Äì Total by Category
    plt.subplot(3, 1, 1)
    cat_sum = df.groupby("Category")["Amount"].sum().sort_values(ascending=False)
    sns.barplot(x=cat_sum.index, y=cat_sum.values, palette="pastel")
    plt.title("Total Expenses by Category")
    plt.ylabel("Amount (‚Çπ)")
    plt.xlabel("")

    # 2Ô∏èPie Chart ‚Äì Category Percentage
    plt.subplot(3, 1, 2)
    plt.pie(cat_sum, labels=cat_sum.index, autopct="%1.1f%%", startangle=140, colors=sns.color_palette("pastel"))
    plt.title("Expense Distribution (Pie Chart)")

    # 3Ô∏èLine Chart ‚Äì Expenses over Time
    plt.subplot(3, 1, 3)
    sns.lineplot(x="Date", y="Amount", data=df, marker="o", color="teal")
    plt.title("Expense Trend Over Time")
    plt.ylabel("Amount (‚Çπ)")
    plt.xlabel("Date")

    plt.tight_layout()
    plt.show()

# GUI
root = tk.Tk()
root.title("Expense Tracker")
root.geometry("360x400")
root.config(bg="#EAF6F6")

tk.Label(root, text="üí∞ Expense Tracker", font=("Arial", 15, "bold"), bg="#EAF6F6", fg="#05386B").pack(pady=10)

# Date
tk.Label(root, text="Date (YYYY-MM-DD):", bg="#EAF6F6").pack()
date_entry = tk.Entry(root, width=30)
date_entry.pack(pady=3)

# Category
tk.Label(root, text="Category:", bg="#EAF6F6").pack()
category_var = tk.StringVar(value="Select")
categories = ["Food", "Transport", "Shopping", "Bills", "Entertainment", "Education", "Health", "Other"]
tk.OptionMenu(root, category_var, *categories).pack(pady=3)

# Amount
tk.Label(root, text="Amount (‚Çπ):", bg="#EAF6F6").pack()
amount_entry = tk.Entry(root, width=30)
amount_entry.pack(pady=3)

# Buttons
tk.Button(root, text="Add Expense", command=save_expense, bg="#379683", fg="white", width=20).pack(pady=5)
tk.Button(root, text="Show All Expenses", command=show_expenses, bg="#5CDB95", fg="white", width=20).pack(pady=5)
tk.Button(root, text="Show Summary", command=show_summary, bg="#8EE4AF", fg="black", width=20).pack(pady=5)
tk.Button(root, text="Show Charts", command=show_chart, bg="#557A95", fg="white", width=20).pack(pady=5)

root.mainloop()
